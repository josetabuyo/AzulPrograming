<!DOCTYPE html>
<html>
	<head>
		<title>
			Azul Programming
		</title>
		<style>
			
			body{
				background-color: white;
				overflow: hidden;
			}
			
			#menu{
				position: absolute;
				top: 0px;
				left: 0px;
				width: 100%;
				height: 30px;
				border-collapse:separate;
				border-spacing:5px;
			}

			.boton{
				border: solid 1px;
				cursor: pointer;
				user-select: none;
				display: table-cell;
				padding: 0px 5px 0px 5px;
				text-align: center;
				font-family: "Arial Black", Gadget, sans-serif;
				background-color: #AAAAAA;
			}
			
			#help{
				color: #A9FFFE;
			}
			
			#plantillas{
				display: none;
			}
			
			ul {
				list-style-type: none;
				margin:0;
				padding:0;
			}
			
			#svgWorld {
				position: absolute;
				right: 0px;
				top: 40px;
				width: 80%;
				height: 100%;
				border: solid 1px;
				overflow: hidden;
				background-color: rgb(255,255,0);
			}
			
			#svgJoystick {
				position: absolute;
				left: 0px;
				top: 40px;
				width: 20%;
				height: 100%;
				border: solid 1px;
				overflow: hidden;
				background-color: rgb(0,0,255);
			}
			
		</style>
		
	</head>
	
	<body>

		<div id="menu">
			<div id="ayuda" class="boton" title="PodÃ©s pedir ayuda">
				Ayuda
			</div>
		</div>
		<svg id="svgJoystick">
			<circle class="control" id="adelante" args="10" fill="#ff00ff" cx="100" cy="50" r="5%">
			</circle>
			<circle class="control" id="derecha" args="10" fill="#ff00ff" cx="150" cy="100" r="5%">
			</circle>
			<circle class="control" id="atras" args="10" fill="#ff00ff" cx="100" cy="150" r="5%">
			</circle>
			<circle class="control" id="izquierda" args="10" fill="#ff00ff" cx="50" cy="100" r="5%">
			</circle>
		</svg>
		
		<svg id="svgWorld" >
			<g id="automata" transform="translate(300,150)">
				<circle fill="#0000ff" cx="0" cy="0" r="20">
				</circle>
				<circle fill="#ff00ff" cx="0" cy="0" r="15">
				</circle>
				<line x1="0" y1="0" x2="20" y2="0" style="stroke:#0000ff;stroke-width:5" />
			</g>
			<path id="trazo" d="M 300 150" stroke="blue" stroke-width="1" fill="none" />
		</svg>
	</body>
	
	
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script src="lib/snap.svg-min.js"></script>
	
	<script>
		
		var automata={};

		$(function(){
			
			
			
			$('body').on('contextmenu', function(e){
				return false;
			});

			$(document).on('keydown', (function(e) {
			
				switch(e.which) {
					case 37:
					automata.izquierda(10);
					break;

					case 38:
					automata.adelante(10);
					break;

					case 39:
					automata.derecha(10);
					break;

					case 40:
					automata.atras(10);
					break;

					default: return;
				}
				e.preventDefault();
			}));



			$('#ayuda').on('click', function(){
				
			});
			
			
			$('.control').on('click', function(){
				
				automata[$(this).attr('id')](parseFloat($(this).attr('args')));
			
			});




			var svgJoystick = Snap("#svgJoystick");

			var svgWorld = Snap("#svgWorld");
			

			automata = {
				ui: (function () {
					


					var ui = Snap("#svgWorld>#automata");

					return ui;
				}()),
				angulo: 0,
				posicion: function(){
					var bb = this.ui.getBBox();

					var pos = {
						x: (bb.x + (bb.width / 2)),
						y: (bb.y + (bb.height / 2))
					};
					return pos;
				},
				adelante: function (step){
					
					console.log("automata.adelante(10);");


					var pos = {
						x: Math.cos(this.angulo/180*3.1415) * step,
						y: Math.sin(this.angulo/180*3.1415) * step,
					};

					this.mover(pos);
				},
				atras: function (step){
					console.log("automata.atras(10);");


					this.adelante(-step);


				},
				derecha: function (step){
					console.log("automata.derecha(10);");
					
					var pos = this.posicion();

					this.angulo += step;
					if(this.angulo>360)this.angulo-=360;
					if(this.angulo<0)this.angulo+=360;
					this.ui.transform( 'T' + pos.x + ',' + pos.y + 'R' + this.angulo + "," + pos.x + ',' + pos.y);

				},
				izquierda: function (step){
					console.log("automata.izquierda(10);");
					this.derecha(-step);
				},
				mover: function(step){
					var pos = this.posicion();

					var pos = {
						x: pos.x + (step.x),
						y: pos.y + (step.y)
					};
					
					
					this.ui.transform( 'T' + pos.x + ',' + pos.y + 'R' + this.angulo + "," + pos.x + ',' + pos.y);

					//this.ui.animate({ 'transform' : pos.x + ',' + pos.y },1000);
					
					var trazo = Snap("#svgWorld>#trazo");
					var path = trazo.attr("d") + " L " + pos.x + ' ' + pos.y;
					

					trazo.attr("d", path)
					
					return "OK"
				}
			};
			

			// Alias
			chuity = automata;
			pincel = automata;

			
		});
	</script>
</html>